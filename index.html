<!DOCTYPE html>
<html lang="en">

<!-- Citation
	Chris Williams
	For his explanation of Leaflet and Open Street Map
	http://bl.ocks.org/williaster/95584ebda56f5345b709
-->
<head>
	<meta charset="utf-8">
  <title>Basic geo (svg)</title>

	<!-- Leaflet + d3 libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js"></script>
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" />

	<!-- Webpage CSS -->
	<link rel="stylesheet" href="styles.css">
</head>

<body>
	<header><h1>Boston Crime</h1></header>
	<nav>
		<div id="map-settings">
	</nav>
	<article>
		<div id="map-container"></div>
	  <div id="map-legend"></div>
	</article>
	</div>
	<footer>* Records with no gps coordinates have been removed from this dataset</footer>


  <script>



		var map = L.map("map-container"),
			bwOsmURL = "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",
	    osmAttrs  = "Map data Â© <a href='http://openstreetmap.org'>OpenStreetMap</a>";

		var osmTiles = new L.TileLayer(bwOsmURL, {
        minZoom: 8,
        maxZoom: 16,
        attribution: osmAttrs
    });



		// Load the crime dataset
		var dataset = "data/crime.csv";
		d3.csv(dataset, function(error, data) {

			//-------------------------------------------
			// Generate Map
			var bostonCoord  = new L.LatLng(42.31, -71.05);

			map.setView(bostonCoord, 12); // latlng, zoom level
			map.addLayer(osmTiles);

			d3.json("data/boston.json", function(data) {
				var districts = data.features;
				districts.forEach(function(d) {
					L.geoJSON(d,{weight:0.5,fill:false,color:'black'}).addTo(map);
				});
			});
			// Generate Map
			//-------------------------------------------



			//-------------------------------------------
			// Create map interface buttons and sliders
			document.getElementById('map-settings').innerHTML =
			`
			<form onchange="updateForm()">
				<label for="time_slider">Time of Day [0,23]</label><br>
				<input type="range" min="0" max="23" value="10" class="slider" id="time_slider">
				<output name="x" for="time_slider" id="time_output"></output>
			</form>
			`;



			//---------------------------------------------
			//Plot crimes
			var markers = [] // Needed to erase markers from previous selection

			window.updateForm = function() {
				var option_time = document.getElementById('time_slider').value;

				// Delete previous markers
				document.getElementById('time_output').value = option_time;
				markers.forEach(function(d) {
					d.remove();
				});

				markers = [] // Clear markers list

				// Add markers for each row satisfying the if statement
				data.forEach(function(d) {
					if (d.HOUR == option_time) {
						var layer = L.circle([+d.Lat,+d.Long], {opacity:0});
						layer.addTo(map);
						markers.push(layer)
					}
				})
			}
			//Plot crimes
			//---------------------------------------------


			updateForm(); // Show markers for initial selection

		}); // End D3 loop
  </script>
</body>
</html>
